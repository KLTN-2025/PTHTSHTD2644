@model SmartTable.Models.Restaurants
@{
    ViewBag.Title = Model.name;
    Layout = "~/Views/Shared/_Layout.cshtml";

    // Helper để hiển thị chi tiết (Chỉ dùng trong mục Giới thiệu)
    @helper DetailItem(string label, object value)
    {
        string displayValue = (value == null || string.IsNullOrWhiteSpace(value.ToString())) ? "N/A" : value.ToString();
        <div class="flex flex-col border-b border-dashed pb-2">
            <dt class="text-xs font-medium text-gray-500 uppercase">@label</dt>
            <dd class="text-sm font-semibold text-gray-800">@displayValue</dd>
        </div>
    }
}

@section styles {
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        .font-display {
            font-family: 'Playfair Display', serif;
        }

        /* CSS cho Tab */
        .tab-link {
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            color: rgb(107 114 128);
            border-bottom-width: 2px;
            border-color: transparent;
            transition: all 0.2s;
            cursor: pointer;
        }

            .tab-link.active {
                color: rgb(37 99 235);
                border-color: rgb(37 99 235);
            }

        .tab-content {
            display: none;
        }

            .tab-content.active {
                display: block;
            }

        .reservation-box {
            position: sticky;
            top: 80px;
        }
    </style>
}

<div class="container mx-auto p-6 lg:py-10">

    <h1 class="font-display text-4xl font-bold mb-3 text-gray-800">@Model.name</h1>
    <p class="text-lg text-gray-700 mb-6">
        <i class="fas fa-map-marker-alt text-red-600 mr-2"></i>
        @Model.address
    </p>

    <div class="flex flex-col lg:flex-row gap-8">

        <div class="lg:w-3/4 space-y-6">

            <div class="bg-white rounded-xl shadow-lg border-t-4 border-blue-600">
                <img src="@(Model.Image ?? "https://via.placeholder.com/800x450.png?text=SmartTable")"
                     alt="Ảnh nhà hàng"
                     class="w-full h-96 object-cover rounded-t-xl shadow-md" />
            </div>

            <div class="bg-white rounded-xl shadow-lg">
                <div class="flex border-b border-gray-200 px-4">
                    <button class="tab-link active" data-tab="gioi-thieu">Giới thiệu & Đặc điểm</button>
                    <button class="tab-link" data-tab="menu">Thực đơn (@Model.MenuItems.Count)</button>
                    <button class="tab-link" data-tab="danh-gia">Đánh giá (@Model.Reviews.Count)</button>
                </div>

                <div class="p-6">
                    <div id="gioi-thieu" class="tab-content active space-y-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Mô tả Chi tiết</h3>
                        <p class="text-gray-700 whitespace-pre-wrap">@(string.IsNullOrEmpty(Model.description) ? "Không có mô tả chi tiết." : Model.description)</p>

                        <h4 class="font-bold text-gray-700 pt-4 border-t pb-2">Đặc điểm Nổi bật</h4>

                        <div class="grid md:grid-cols-2 gap-x-8 gap-y-4">
                            <div class="space-y-3">
                                @DetailItem("Giờ hoạt động", @Model.opening_hours)
                                @DetailItem("Giờ đông khách", @Model.BusyHours)
                                @DetailItem("Giờ vắng khách", @Model.SlowHours)
                                @DetailItem("Phong cách Ẩm thực", @Model.CuisineStyle)
                                @DetailItem("Loại hình Dịch vụ", @Model.ServiceDescription)
                                @DetailItem("Kiểu phục vụ", @Model.ServiceTypes)
                            </div>
                            <div class="space-y-3">
                                @DetailItem("Số bàn/Sức chứa", @Model.max_tables)
                                @DetailItem("Phòng riêng", (@Model.PrivateRoomCount ?? "N/A"))
                                @DetailItem("Kiểu chỗ ngồi", @Model.SeatingType)
                                @DetailItem("Tiện ích", @Model.Amenities)
                                @DetailItem("Địa điểm gần", @Model.NearbyLandmark)
                                @DetailItem("Hóa đơn TB/người", @Model.AverageBill)
                            </div>
                        </div>
                    </div>

                    <div id="menu" class="tab-content space-y-4">
                        <h3 class="text-xl font-semibold text-gray-800">Thực đơn nổi bật</h3>
                        @if (!Model.MenuItems.Any())
                        {
                            <p class="text-gray-500">Menu đang được cập nhật...</p>
                        }
                        else
                        {
                            <ul class="space-y-3">
                                @foreach (var item in Model.MenuItems)
                                {
                                    <li class="p-3 border rounded-lg flex justify-between items-center bg-gray-50 shadow-sm">
                                        <div>
                                            <span class="font-semibold text-gray-900">@item.name</span>
                                            <p class="text-xs text-gray-500">@item.description</p>
                                        </div>
                                        <span class="font-bold text-red-600">@item.price.ToString("N0") VNĐ</span>
                                    </li>
                                }
                            </ul>
                        }
                    </div>

                    <div id="danh-gia" class="tab-content space-y-4">
                        <h3 class="text-xl font-semibold text-gray-800">Đánh giá khách hàng</h3>
                        @if (!Model.Reviews.Any())
                        {
                            <p class="text-gray-500">Chưa có đánh giá nào.</p>
                        }
                        else
                        {
                            <p class="text-gray-500">Chức năng Reviews đang được hoàn thiện...</p>
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="lg:w-1/4">
            <div class="reservation-box bg-white rounded-xl shadow-2xl p-6 border-t-8 border-red-600">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center font-display">
                    Đặt Bàn Ngay
                </h2>

                @using (Html.BeginForm("DatBan", "DatBan", FormMethod.Get, new { @class = "space-y-4" }))
                {
                    @Html.Hidden("id", Model.restaurant_id)
                    @Html.AntiForgeryToken()

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Số lượng khách</label>
                        <input type="number" name="NumberOfPeople" min="1" value="2" required class="w-full p-2 border rounded-lg">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Ngày đến</label>
                        <input type="date" name="ReservationDate" required value="@DateTime.Now.ToString("yyyy-MM-dd")" class="w-full p-2 border rounded-lg">
                    </div>

                    <button type="submit"
                            class="w-full mt-4 px-6 py-3 bg-red-600 text-white font-semibold rounded-lg shadow-lg hover:bg-red-700 transition-transform transform hover:scale-105 text-lg">
                        TIẾP TỤC ĐẶT BÀN
                    </button>
                }
            </div>
        </div>
    </div>
</div>


@section scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Logic Tab Switching
            const tabs = document.querySelectorAll('.tab-link');
            const contents = document.querySelectorAll('.tab-content');

            document.getElementById('gioi-thieu').classList.add('active'); // Khởi tạo nội dung
            document.querySelector('.tab-link[data-tab="gioi-thieu"]').classList.add('active', 'border-blue-600', 'text-blue-600'); // Khởi tạo nút


            tabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const targetId = e.currentTarget.getAttribute('data-tab');

                    tabs.forEach(t => t.classList.remove('active', 'border-blue-600', 'text-blue-600'));
                    contents.forEach(c => c.classList.remove('active'));

                    e.currentTarget.classList.add('active', 'border-blue-600', 'text-blue-600');
                    document.getElementById(targetId).classList.add('active');
                });
            });
        });
    </script>
}