@model IEnumerable<SmartTable.Models.Users>
@{
    ViewBag.Title = "Quản lý Vai trò và Tài khoản";
}

<h1 class="text-2xl font-bold text-gray-800 mb-4">Quản lý Vai trò và Tài khoản</h1>
<p class="mb-4 text-gray-600">Sửa đổi vai trò (Admin, Business, User) của người dùng.</p>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}

<div class="bg-white shadow-xl rounded-lg overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-100">
            <tr>
                <th class="px-6 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider">ID</th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Họ và Tên</th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Email/SĐT</th>
                <th class="px-6 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider">Vai trò hiện tại</th>
                <th class="px-6 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider">Thay đổi vai trò</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-100">
            @foreach (var item in Model)
            {
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 text-center text-gray-700">@item.user_id</td>
                    <td class="px-6 py-4 font-medium text-gray-900">@item.full_name</td>
                    <td class="px-6 py-4 text-sm text-gray-700">
                        <div>@item.email</div>
                        <div class="text-xs text-gray-500">@item.phone</div>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
                            @(item.role == "Admin" ? "bg-red-100 text-red-800" : (item.role == "business" ? "bg-blue-100 text-blue-800" : "bg-gray-100 text-gray-800"))">
                            @item.role
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        @using (Html.BeginForm("UpdateRole", "Role", FormMethod.Post, new { area = "Admin", @class = "flex space-x-2" }))
                        {
                            @Html.AntiForgeryToken()
                            @Html.Hidden("userId", item.user_id)

                            <select name="newRole" class="form-select border rounded-lg text-sm p-1.5 w-full">
                                <option value="User" @(item.role == "User" ? "selected" : "")>User (Khách hàng)</option>
                                <option value="business" @(item.role == "business" ? "selected" : "")>Business (Đối tác)</option>
                                <option value="Admin" @(item.role == "Admin" ? "selected" : "")>Admin (Quản trị)</option>
                            </select>

                            <button type="submit" class="px-3 py-1.5 bg-blue-600 hover:bg-green-600 text-white rounded-lg text-sm shadow-md transition">
                                Lưu
                            </button>
                        }
                    </td>
                    <td class="px-6 py-4 text-center">
                        @* Thêm nút xóa/khóa tài khoản tại đây nếu cần *@
                        <a href="#" class="text-red-500 hover:text-red-700"><i class="fas fa-trash-alt"></i></a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>